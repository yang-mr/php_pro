
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>欢迎</title>
<script language="JavaScript" src="../public/js/jquery-3.2.1.min.js"></script>
<link rel="stylesheet" type="text/css" href="../public/css/login.css">
<script>
    function refreshVerify() {
        var ts = Date.parse(new Date())/1000;
        $('#verify_img').attr("src", "/captcha?id="+ts);
    }
</script>
</head>
<body>
<div>
  <table id="top_bar" width="100%">
    <tr>
      <th width="70%" id="user_index">欢迎来到礼物会</th>
      <th><a href="#">帮助中心</a></th>
      <th>手机商城</th>
      <th>咨询热线</th>
    </tr>
  </table>
</div>
<div class="htmleaf-container">
<div id="wrapper" class="login-page">

<div id="login_form" class="form">
<form class="register-form">
<table>
  <tr>
    <th>用户名：</th><th><input type="text" name="name" placeholder="请输入用户名" id="r_user_name"></th>
  </tr>
   <tr>
    <th>请设置密码：</th><th><input type="password" name="pwd1" placeholder="密码" id="r_password"></th>
  </tr>
   <tr>
    <th>请确认密码：</th><th><input type="text" name="pwd2" placeholder="再次密码" id="r_password2"></th>
  </tr>
<!--    <tr>
    <th>验证码：</th><th><input type="text" name="code" placeholder="请输入验证码"/></th><th><div><img id="verify_img" src="{:captcha_src()}" alt="captcha"  onclick="refreshVerify()"/><a href="javascript:refreshVerify()">点击刷新</a></div>
</div></th>
  </tr> -->
   <!-- <tr>
    <th>短信验证码：</th><th><input type="text" name="phonecode" placeholder="短信验证码"/></th><th><button id="getphonecode">获取验证码</button></th>
  </tr> -->
</table>
<button type="submit" id="create">创建账号</button>
<p class="message">已经有了一个账户? <a href="#">立刻登录</a></p>
</form>

<form class="login-form">
<input type="text" name="username" placeholder="用户名" id="user_name">
<input type="password" name="password" placeholder="密码" id="password">
<button id="login">登 录</button>
<p class="message" id='toregister'>还没有账户? <a href="#">立刻创建</a></p>
</form>
</div>
</div>
</div>
<script type="text/javascript">
function check_login()
{
 var name=$("#user_name").val();
 var pass=$("#password").val();
 if ("" == name || "" == pass) {
      showError();
      alert("用户名和密码不能为空");
      return;
 }

 $.post("../controller/login.php",
  {
    username:name,
    password:pass,
    action:'login'
  },
  function(data, status){
    if ('success' == status) {
        if (data == 0) {
          alert("用户名错误");
           $("#login_form").removeClass('shake_effect');  
            setTimeout(function()
            {
             $("#login_form").addClass('shake_effect')
            },1);  
        } else if (data == 1) {
          alert("密码错误");
           $("#login_form").removeClass('shake_effect');  
            setTimeout(function()
            {
             $("#login_form").addClass('shake_effect')
            },1);  
        } else if (data == 2) {
          $("#user_index").html("欢迎" + name + "来到礼物汇");
          alert("登录成功");
          $("#wrapper").hide();
        }
    }
  });
}

function check_register(){
    var name = $("#r_user_name").val();
    var pass = $("#r_password").val();
    var pass2 = $("#r_password2").val();

    if ("" == name || "" == pass) {
      alert("用户名和密码不能为空");
      showError();
      return;
      }
    if (pass != pass2) {
      alert("两次密码要相同");
      showError();
      return;
      }

  $.post("../controller/login.php",
  {
    username:name,
    password:pass,
    action:'register'
  },
  function(data, status){
    if ('success' == status) {
        if (data == 0) {
           alert("该用户已存在");
           showError(); 
        } else if (data == 1) {
           $("#user_index").html("欢迎" + name + "来到礼物汇");
           $("#wrapper").hide();
           alert("注册成功");
        } else if (data == 2) {
          alert("注册失败");
          showError();
        }
    }
  });
}

function showError(){
   $("#login_form").removeClass('shake_effect');  
      setTimeout(function()
      {
       $("#login_form").addClass('shake_effect')
      },1);
}

function showres(){
  $(".login_form #register-form").show();
  $(".login_form #login-form").hide();
}
$(function(){
     $.post("../controller/login.php",
    function(data, status){
      alert(data);
    if ('success' == status) {
        if (data == 0) {
        } else {
          $("#user_index").html("欢迎" + name + "来到礼物汇");
          $("#wrapper").hide();
        }
    }
  });

    $("#create").click(function(){
        check_register();
        return false;
    })
    $("#login").click(function(){
        check_login();
        return false;
    })
     $("#toregister").click(function(){
        showres();
        return false;
    })
    $('.message a').click(function () {
        $('form').animate({
            height: 'toggle',
            opacity: 'toggle'
        }, 'slow');
    });
})
</script>
</body>
</html>